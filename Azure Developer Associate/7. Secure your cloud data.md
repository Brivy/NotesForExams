# Secure your cloud data

This is the seventh chapter of the online Azure Developer Associate course.

## Protect against security threats on Azure

Recap of the previous exam (az-900)

### Protect against security threats by using Azure Security Center

Azure Security Center is a monitoring service that provides visibility of your security posture across all of your services, both on Azure and on-premises. The term *security posture* refers to cybersecurity policies and controls, as well as how well you can predict, prevent, and respond to security threats.

It can be used for:

- *Monitor* security settings across on-premises and cloud workloads.
- Automatically *apply required security settings* to new resources as they come online.
- Provide *security recommendations* that are based on your current configurations, resources, and networks.
- Continuously *monitor your resources* and perform automatic security assessments to identify potential vulnerabilities before those vulnerabilities can be exploited.
- Use *machine learning* to detect and block malware from being installed on your virtual machines (VMs) and other resources. You can also use adaptive application controls to define rules that list allowed applications to ensure that only applications you allow can run.
- *Detect and analyze potential inbound attacks* and investigate threats and any post-breach activity that might have occurred.
- Provide *just-in-time access control for network ports*.

Two other niece features are:

- Viewing its overall *regulatory compliance* from a security perspective all from one place.
- Viewing the *Resource security hygiene section*, the health of its resources from a security perspective can been seen.
- Viewing the *Secure Score* (based on security controls, or groups of related security recommendations) can also give you an security insight.

The Security Center has some threat protection:

- **Just-in-time VM access**: This access blocks traffic by default to specific network ports of VMs, but allows traffic for a specified time when an admin requests and approves it.
- **Adaptive application controls**: In the background, Security Center uses machine learning to look at the processes running on a VM. It creates exception rules for each resource group that holds the VMs and provides recommendations. This process provides alerts that inform the company about unauthorized applications that are running on its VMs.
- **Adaptive network hardening**: Security Center can monitor the internet traffic patterns of the VMs, and compare those patterns with the company's current network security group (NSG) settings. From there, Security Center can make recommendations about whether the NSG should be locked down further and provide remediation steps.
- **File integrity monitoring**: Monitor changes of important files on both Windows and Linux, registry settings, applications, and other aspects that might indicate a security attack.

But what if it goes wrong:

- You can manually review all alerts and investigate them further.
- Using *workflow automation* (see Azure Logic Apps), you can automate this process (like sending mails etc.).

### Detect and respond to security threats by using Azure Sentinel

Security management on a large scale can benefit from a dedicated **security information and event management** (SIEM) system. A SIEM system aggregates security data from many different sources (as long as those sources support an open-standard logging format). It also provides capabilities for threat detection and response. Azure Sentinel is a SIEM platform created by Microsoft.

The platform can do the following:

- Collect cloud data at scale across all users, devices, applications
- Detect previously undetected threats
- Investigate threats with artificial intelligence
- Respond to incidents rapidly with built-in orchestration and automation of common tasks.

You can connect it to multiple data sources to analyse security events. For example:

- Connectors provide real-time integration for *Microsoft services* like Microsoft Threat Protection solutions, Microsoft 365 sources (including Office 365), Azure Active Directory, and Windows Defender Firewall.
- Connectors are available for common *non-Microsoft services and solutions*, including AWS CloudTrail, Citrix Analytics (Security), Sophos XG Firewall, VMware Carbon Black Cloud, and Okta SSO.
- Azure Sentinel supports data from *other sources* that use the Common Event Format (CEF) messaging standard, Syslog, or REST API.

It can detect threats by using templates. There are two kinds of templates available:

- **Build in analytics**: Designed by Microsoft's team of security experts and analysts based on known threats, common attack vectors, and escalation chains for suspicious activity.
- **Custom analytics**: Rules that you create to search for specific criteria within your environment. You can preview the number of results that the query would generate (based on past log events) and set a schedule for the query to run. You can also set an alert threshold.

If a problem arises, you can investigate specific alerts or *incidents* (a group of related alerts) in a *investigation graph*. But instead of manually detecting all this, you can use the **Azure Monitor Workbook** to automate responses to threats. For example:

1. When the alert is triggered, open a ticket in the IT ticketing system.
2. Send a message to the security operations channel in Microsoft Teams or Slack to make sure the security analysts are aware of the incident.
3. Send all of the information in the alert to the senior network admin and to the security admin. The email message includes two user option buttons: Block or Ignore.

### Store and manage secrets by using Azure Key Vault

Azure Key Vault is a centralized cloud service for storing an application's secrets in a single, central location. It provides secure access to sensitive information by providing access control and logging capabilities.

With this service, you can do the following:

- **Manage secrets**: You can use Key Vault to securely store and tightly control access to tokens, passwords, certificates, API keys, and other secrets.
- **Manage encryption keys**: You can use Key Vault as a key management solution. Key Vault makes it easier to create and control the encryption keys that are used to encrypt your data.
- **Manage SSL/TLS certificates**: Key Vault enables you to provision, manage, and deploy your public and private Secure Sockets Layer/Transport Layer Security (SSL/TLS) certificates for both your Azure resources and your internal resources.
- **Store secrets backed by hardware security modules (HSMs)**: These secrets and keys can be protected either by software or by FIPS 140-2 Level 2 validated HSMs.

It has the following benefits:

- Centralized application secrets.
- Securely stored secrets and keys.
- Access monitoring and access control.
- Simplified administration of application secrets and to enroll and renew certificates from public certificate authorities (CAs).
- Integration with other Azure services like storage accounts, container registries and many more Azure services.

### Host your Azure virtual machines on dedicated physical servers by using Azure Dedicated Host

Some organizations must follow regulatory compliance that requires them to be the only customer using the physical machine that hosts their virtual machines (it's shared machinery otherwise). Azure Dedicated Host provides dedicated physical servers to host your Azure VMs for Windows and Linux.

A *dedicated host* is mapped to a physical server in an Azure datacenter. A *host group* is a collection of dedicated hosts. See the following picture:
![Cool picture](Pictures/dedicated-hosts.png)

But why should you use it?

- Gives you visibility into, and control over, the server infrastructure that's running your Azure VMs.
- Helps address compliance requirements by deploying your workloads on an isolated server.
- Lets you choose the number of processors, server capabilities, VM series, and VM sizes within the same host.

---

Extra notes on the dedicated host:

- For higher availability, you can provision multiple hosts in a host group, and deploy your VMs across this group.
- VMs on dedicated hosts can also take advantage of *maintenance control* (control when regular maintenance updates occur).
- It's more expensive than a normal vm.

## Top 5 security items to consider before pushing to production

Security is top-of-mind for most people working in technology, and this is especially true when it comes to software. It seems we are constantly hearing about companies and governments that we entrusted our private data to, being compromised.

### Azure Security Center

**Azure Security Center** (ASC) is a monitoring service that provides threat protection across all of your services both in Azure, and on-premises. There are two versions:

- Free: Provides security policies, assessments, and recommendations
- Standard: Provides a robust set of features, including threat intelligence

![Cool picture](Pictures/2-pricing-tier.png)

To upgrade a subscription to the Standard tier, you must be assigned the role of Subscription Owner, Subscription Contributor, or Security Admin.

In general, ASC can:

- Provide security recommendations based on your configurations, resources, and networks.
- Monitor security settings across on-premises and cloud workloads and automatically apply required security to new services as they come online.
- Continuously monitor all your services and perform automatic security assessments to identify potential vulnerabilities before they can be exploited.
- Use machine learning to detect and block malware from being installed in your services and virtual machines. You can also allowlist applications to ensure that only the apps you validate are allowed to execute.
- Analyze and identify potential inbound attacks and help to investigate threats and any post-breach activity which might have occurred.
- **Just-In-Time access control** for ports, reducing your attack surface by ensuring the network only allows traffic you require.

### Inputs and Outputs

When writing application, you should validate all input. Some tips:

- Always use an allow list approach, which means you only accept "known good" input, instead of a deny list (where you specifically look for bad input).
- Validate on the server, not the client-side (or in addition to the client-side), to ensure that your defenses cannot be circumvented. 
- Treat ALL data as untrusted and you will protect yourself from most of the common web app vulnerabilities.

And some application specific tips:

- Using parameterized queries
- Encode your output

### Secrets in Key Vault

**Azure Key Vault** is a secret store: a centralized cloud service for storing application secrets. It allows users to store connection strings, secrets, passwords, certificates, access policies, file locks (making items in Azure read-only), and automation scripts. It also logs access and activity, allows you to monitor access control (IAM) in your subscription, and it also has diagnostic, metrics, alerts and troubleshooting tools, to ensure you have the access you need.

---

Other notes that can make your application more secure are:

- Using the latest version of your framework
- Verify if your dependencies and libraries are safe for use

## Configure security policies to manage data

Classifying (or categorizing) stored data by sensitivity and business impact helps organizations determine the risks associated with the data. After your data has been classified, organizations can manage their data in ways that reflect their internal value instead of treating all data the same way.

### Classify your data at rest, in process, and in transit
