# Store data in Azure

This is the third chapter of the online Azure Developer Associate course.

## Choose a data storage approach in Azure

The key factors to consider in deciding on the optimal storage solution are: how to classify your data, how your data will be used, and how you can get the best performance for your application.

### Classify the data

**Structured data**, sometimes referred to as *relational data*, is data that adheres to a strict schema, so all of the data has the same fields or properties. This type of data can be searched with SQL.

**Semi-structured** (also referred to as *NoSQL*) data is less organized than structured data, and is not stored in a relational format, as the fields do not neatly fit into tables, rows, and columns. The expression and structure of the data in this style is defined by a *serialization language*.
Data serialization languages are important because they can be used to write data stored in memory to a file, sent to another system (that uses the same language), parsed and read. There are three of those languages:

- XML (extensible markup language)
- JSON (JavaScript Object Notation)
- YAML (YAML Ainâ€™t Markup Language)

**Unstructured data** is often delivered in files, such as photos or videos. The video file itself may have an overall structure and come with semi-structured metadata, but the data that comprises the video itself is unstructured. Some examples:

- Media files, such as photos, videos, and audio files
- Office files, such as Word documents
- Text files
- Log files

When choosing the type of data, you can ask yourself one of these questions:

- Will you be doing simple lookups using an ID?
- Do you need to query the database for one or more fields?
- How many create, update, and delete operations do you expect?
- Do you need to run complex analytical queries?
- How quickly do these operations need to complete?

### Data transactions

A transaction is a logical group of database operations that execute together. Transactions are often defined by a set of four requirements, referred to as ACID guarantees. ACID stands for:

- **Atomicity** means a transaction must execute exactly once and must be atomic; either all of the work is done, or none of it is. Operations within a transaction usually share a common intent and are interdependent.
- **Consistency** ensures that the data is consistent both before and after the transaction.
- **Isolation** ensures that one transaction is not impacted by another transaction.
- **Durability** means that the changes made due to the transaction are permanently saved in the system. Committed data is saved by the system so that even in the event of a failure and system restart, the data is available in its correct state.

Transactional databases are often called **OLTP** (Online Transaction Processing) systems. OLTP systems commonly support lots of users, have quick response times, handle large volumes of data and are highly available but handle small/simple transactions.
There are also **OLAP** (Online Analytical Processing) systems, but they commonly support fewer users, have longer response times, can be less available, and typically handle large and complex transactions.

### Determine which service is best for the data type

Semi-structured data that requires a high number of reads and writes (high throughput and low latency) should use **Azure Cosmos DB**. This also has transactional support (ACID-compliant) for when it's needed. Data replication is also supported around the world by a single click, based on your consistency level (a tradeoff between consistency, availability, latency, and throughput)
One thing to note is that other Azure services such as Azure Table storage, Azure HBase as a part of HDInsight, and Azure Cache for Redis, can also store NoSQL data. But if you want to query on multiple fields, Azure Cosmos DB is a better fit because it indexes every field by default. Other services are limited in the data they index, and querying on non-indexed fields results in reduced performance.

Unstructured data that requires retrieval by ID, a high number of read operations with a low latency, but for the create/update a higher latency than read operations should use **Azure Blob storage**. Because this service can work with Azure Content Delivery Network (CDN), it can reduce the latency for serving the files.
Other options are to upload the files to the Azure App Services so that the same server that is running your app is serving up your images. But this solution only works if you don't have many files.

Structured data that we all know and love can make use of **Azure SQL Database**. Another service is for example Azure Synapse. It supports OLAP solutions and SQL queries but no cross-database queries.

Some extra stuff about BI databases:

- Azure Stream Analytics can be used in addition to Azure SQL Database. But you need to use Power BI instead of SQL.
- Azure Analyses Services is a great way to analyze data and transform it into actionable insights, but its focus is on real-time data that is streaming in. If you need historical data only, you don't need it.

## Create an Azure Storage account

Most organizations have diverse requirements for their cloud-hosted data. For example, storing data in a specific region, or needing separate billing for different data categories. Azure storage accounts let you formalize these types of policies and apply them to your Azure data.

### Azure storage explained

While you have a lot of services inside Azure that can store stuff, there are four services selected to be under the name of **Azure Storage**:

![Cool picture](Pictures/2-azure-storage.png)

A **storage account** is a container that groups a set of Azure Storage services together. The settings you specify when you create the account, or any that you change after creation, are applied to everything in the account. Deleting the storage account deletes all of the data stored inside it. A group can for example look like this:

![Cool picture](Pictures/2-what-is-a-storage-account.png)

While a storage account is an Azure resource and is included in a resource group, other services like Azure SQL and Azure Cosmos DB are managed as independent Azure resources. See the following example:

![Cool picture](Pictures/2-typical-subscription-organization.png)

If you are configuring the settings of one storage account, it will act as a policy for all the services inside that account. Some of those settings are:

Non-cost effective settings:

- **Name**: Each storage account has a name. The name must be globally unique within Azure, use only lowercase letters and digits and be between 3 and 24 characters.
- **Deployment model**: This is the system Azure uses to organize your resources. There are two selectable:
  - *Resource Manager*: The one you know and love. Supports the concept of a resource groups compared to Classic. Microsoft recommends this.
  - *Classic*: A legacy offering that uses the Azure Service Management API.
- **Account kind**: This is a set of policies that determine which data services you can include in the account and the pricing of those services. There are three available with two legacy variants (but they can be cheaper to use):
  - *StorageV2 (general purpose v2)*: the current offering that supports all storage types and all of the latest features. Microsoft recommends this.
  - *Storage (general purpose v1)*: a legacy kind that supports all storage types but may not support all features.
  - *Blob storage*: a legacy kind that allows only block blobs and append blobs.

Cost effective settings:

- **Subscription**: The Azure subscription that will be billed for the services in the account.
- **Location**: The datacenter that will store the services in the account.
- **Performance**: Type of hardware to save your files on:
  - *Standard* allows you to have any data service (Blob, File, Queue, Table) and uses magnetic disk drives.
  - *Premium* introduces additional services for storing data. For example, storing unstructured object data as block blobs or append blobs, and specialized file storage used to store and create premium file shares. These storage accounts use solid-state drives (SSD) for storage.
- **Replication**: At a minimum, Azure will automatically maintain three copies of your data within the data center associated with the storage account. This is called *locally-redundant storage (LRS)*, and guards against hardware failure but does not protect you from an event that incapacitates the entire datacenter. You can upgrade to one of the other options such as *geo-redundant storage (GRS)* to get replication at different datacenters across the world.
- **Access tier**: Controls how quickly you will be able to access the blobs in this storage account (Hot, cool, etc.).
- **Secure transfer required**: A security feature that determines the supported protocols for access. Enabled requires HTTPs, while disabled allows HTTP.
- **Virtual networks**: A security feature that allows inbound access requests only from the virtual network(s) you specify.

There are a few things that determine how many storage account you will need:

- Different settings means different storage accounts.
- If you have a lot of data diversity, multiple storage accounts are probably needed (different regions, different departments, etc.).
- Different settings leads to different costs.
- Implementing management by using different accounts.

---

Note:

- Instead of the common Portal/CLI/PowerShell options, you can use **Management client libraries** to work with storage accounts.
